<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Edit Order</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Edit Order</h1>
      <form id="editOrderForm">
        <input
          type="text"
          id="customerName"
          placeholder="Customer Name"
          required
        />
        <input
          type="text"
          id="customerAddress"
          placeholder="Customer Address"
          required
        />
        <input type="date" id="orderDate" required />
        <input
          type="text"
          id="productName"
          placeholder="Product Name"
          required
        />
        <input
          type="number"
          step="0.01"
          id="productPrice"
          placeholder="Product Price"
          required
        />
        <input type="number" id="quantity" placeholder="Quantity" required />
        <button type="submit">Save Changes</button>
      </form>
    </div>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const orderId = localStorage.getItem("editOrderId");
        if (!orderId) {
          alert("No order selected for editing");
          window.location.href = "index.html";
          return;
        }

        fetch(`http://localhost:3000/orders/${orderId}`)
          .then((res) => {
            if (!res.ok) throw new Error("Failed to fetch order");
            return res.json();
          })
          .then((order) => {
            document.getElementById("customerName").value = order.customerName;
            document.getElementById("customerAddress").value =
              order.customerAddress;
            document.getElementById("orderDate").value = new Date(
              order.orderDate
            )
              .toISOString()
              .split("T")[0];
            document.getElementById("productName").value = order.productName;
            document.getElementById("productPrice").value = order.price;
            document.getElementById("quantity").value = order.quantity;
          })
          .catch((err) => {
            alert("Failed to load order data: " + err.message);
            window.location.href = "index.html";
          });

        document
          .getElementById("editOrderForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const data = {
              customerName: document
                .getElementById("customerName")
                .value.trim(),
              customerAddress: document
                .getElementById("customerAddress")
                .value.trim(),
              orderDate: document.getElementById("orderDate").value,
              productName: document.getElementById("productName").value.trim(),
              productPrice: parseFloat(
                document.getElementById("productPrice").value
              ),
              quantity: parseInt(document.getElementById("quantity").value, 10),
            };

            fetch(`http://localhost:3000/orders/${orderId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            })
              .then((res) => {
                if (!res.ok) throw new Error("Failed to update order");
                return res.json();
              })
              .then((resp) => {
                if (resp.success) {
                  alert("Order updated successfully!");
                  localStorage.removeItem("editOrderId");
                  window.location.href = "index.html";
                } else {
                  alert("Failed to update order.");
                }
              })
              .catch((err) => alert("Server error: " + err.message));
          });
      });
    </script>
  </body>
</html>
